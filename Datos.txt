ğŸ§© 1. DAO (Data Access Object)

ğŸ“ org.iesalixar.daw2.OrtegaAlvaro.dao

AquÃ­ va todo lo relacionado con la base de datos: conexiÃ³n, consultas, inserciones, actualizaciones, etc.

DatabaseConnectionManager â†’
ğŸ”Œ Se encarga de conectarse a la base de datos (usando el .env para URL, usuario y contraseÃ±a).
Implementa el patrÃ³n Singleton â†’ solo hay una conexiÃ³n abierta.

VideogameDAO â†’
ğŸ“œ Es una interfaz que define los mÃ©todos CRUD:
listAllGames(), insertGame(), updateGame(), deleteGame(), etc.
No tiene cÃ³digo, solo la "promesa" de que alguien los implementarÃ¡.

VideogameDAOImpl â†’
ğŸ§± Es la implementaciÃ³n de esa interfaz.
Contiene el cÃ³digo SQL real que conecta con la base de datos y ejecuta las operaciones CRUD sobre la tabla videogames.

DataInitializer â†’
ğŸŒ± Clase auxiliar que normalmente inicializa la base de datos cuando arranca la aplicaciÃ³n (por ejemplo, crea tablas o inserta datos de prueba si no existen).

ğŸ® 2. Entity

ğŸ“ org.iesalixar.daw2.OrtegaAlvaro.entity

Videogame â†’
ğŸ“¦ Es una clase modelo o entidad, que representa un registro de la tabla videogames en Java.
Tiene atributos (id, title, genre, platform, price), su constructor, getters/setters, y posiblemente toString() o equals().

ğŸ‘‰ En resumen: cada fila de la tabla videogames se convierte en un objeto Videogame.

ğŸ§ 3. Listener

ğŸ“ org.iesalixar.daw2.OrtegaAlvaro.listener

AppContextListener â†’
ğŸ Es un escuchador del ciclo de vida de la aplicaciÃ³n web (ServletContextListener).
Se ejecuta automÃ¡ticamente cuando el servidor (Tomcat, Jetty, etc.) inicia o apaga la aplicaciÃ³n.
Suele servir para cosas como:

Iniciar la conexiÃ³n a la base de datos.

Ejecutar DataInitializer.

Cargar configuraciones globales o variables de entorno.

ğŸŒ 4. Servlets

ğŸ“ org.iesalixar.daw2.OrtegaAlvaro.servlets

Son las clases que manejan las peticiones HTTP (GET, POST, etc.) y sirven de puente entre el usuario y la base de datos.

VideogameServlet â†’
ğŸ® Controla las operaciones relacionadas con los videojuegos: listar, aÃ±adir, modificar o eliminar.
Llama a los mÃ©todos del VideogameDAOImpl y redirige a los JSP correspondientes.
(Por ejemplo, /videogames â†’ muestra la lista; /add â†’ inserta uno nuevo.)

LanguageServlet â†’
ğŸŒ Gestiona el cambio de idioma de la aplicaciÃ³n (por ejemplo, espaÃ±ol â†” inglÃ©s).
Probablemente guarda la preferencia del usuario en una sesiÃ³n o cookie.

ğŸ“‚ 5. Resources y JSP

ğŸ“ src/main/resources y src/main/webapp

.env â†’
Archivo de configuraciÃ³n con las variables de entorno (URL, usuario y contraseÃ±a de la BD).
Se lee con la librerÃ­a dotenv.

*.jsp (Java Server Pages) â†’
ğŸ–¥ï¸ Son las pÃ¡ginas web de la aplicaciÃ³n, donde se muestra la informaciÃ³n al usuario.
Se combinan con los Servlets:

El Servlet procesa los datos â†’

Los pasa a un JSP â†’

El JSP los muestra en formato HTML.

=======

==============================
CRUD EN JAVA (Servlets + JSP + DAO)
==============================

1ï¸âƒ£ Crear la entidad (modelo)
-----------------------------
ğŸ“ package: entity
ğŸ“„ Ejemplo: Videogame.java

- Representa una tabla de la base de datos (videogames).
- Contiene atributos, constructores, getters y setters.

public class Videogame {
    private int id;
    private String title;
    private String genre;
    private String platform;
    private double price;

    public Videogame() {}
    public Videogame(int id, String title, String genre, String platform, double price) {
        this.id = id;
        this.title = title;
        this.genre = genre;
        this.platform = platform;
        this.price = price;
    }

    // Getters y Setters
}


2ï¸âƒ£ Crear la conexiÃ³n a la base de datos
---------------------------------------
ğŸ“ package: dao
ğŸ“„ DatabaseConnectionManager.java

- Gestiona la conexiÃ³n a la BD.
- Usa variables de entorno (.env) para url, usuario y contraseÃ±a.

public class DatabaseConnectionManager {
    private static Connection connection = null;

    public static Connection getConnection() throws SQLException {
        if (connection == null || connection.isClosed()) {
            String url = dotenv.get("DB_URL");
            String user = dotenv.get("DB_USER");
            String pass = dotenv.get("DB_PASSWORD");
            connection = DriverManager.getConnection(url, user, pass);
        }
        return connection;
    }
}


3ï¸âƒ£ Crear la interfaz DAO
------------------------
ğŸ“ package: dao
ğŸ“„ VideogameDAO.java

- Define las operaciones disponibles (CRUD).

public interface VideogameDAO {
    List<Videogame> listAllGames() throws SQLException;
    Videogame getGameById(int id) throws SQLException;
    void insertGame(Videogame game) throws SQLException;
    void updateGame(Videogame game) throws SQLException;
    void deleteGame(int id) throws SQLException;
}


4ï¸âƒ£ Implementar el DAO
---------------------
ğŸ“ package: dao
ğŸ“„ VideogameDAOImpl.java

- AquÃ­ se hacen las consultas SQL reales.
- Usa PreparedStatement y ResultSet.

public class VideogameDAOImpl implements VideogameDAO {
    @Override
    public List<Videogame> listAllGames() throws SQLException {
        List<Videogame> list = new ArrayList<>();
        String sql = "SELECT * FROM videogames";
        try (Connection conn = DatabaseConnectionManager.getConnection();
             PreparedStatement ps = conn.prepareStatement(sql);
             ResultSet rs = ps.executeQuery()) {
            while (rs.next()) {
                list.add(new Videogame(
                    rs.getInt("id"),
                    rs.getString("title"),
                    rs.getString("genre"),
                    rs.getString("platform"),
                    rs.getDouble("price")
                ));
            }
        }
        return list;
    }
    // (insert, update, delete, getById similares)
}


5ï¸âƒ£ Crear el Servlet controlador
-------------------------------
ğŸ“ package: servlets
ğŸ“„ VideogameServlet.java

- ActÃºa como controlador.
- Recibe peticiones del usuario y decide quÃ© hacer.
- Se comunica con el DAO y con los JSP.

@WebServlet("/videogames")
public class VideogameServlet extends HttpServlet {
    private VideogameDAO dao = new VideogameDAOImpl();

    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        String action = request.getParameter("action");

        try {
            switch (action == null ? "list" : action) {
                case "new":
                    request.getRequestDispatcher("videogame-form.jsp").forward(request, response);
                    break;
                case "edit":
                    int id = Integer.parseInt(request.getParameter("id"));
                    Videogame game = dao.getGameById(id);
                    request.setAttribute("game", game);
                    request.getRequestDispatcher("videogame-form.jsp").forward(request, response);
                    break;
                default:
                    List<Videogame> list = dao.listAllGames();
                    request.setAttribute("listGames", list);
                    request.getRequestDispatcher("videogames.jsp").forward(request, response);
                    break;
            }
        } catch (SQLException e) {
            throw new ServletException(e);
        }
    }

    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        String action = request.getParameter("action");

        try {
            if ("insert".equals(action)) {
                Videogame game = new Videogame(0,
                        request.getParameter("title"),
                        request.getParameter("genre"),
                        request.getParameter("platform"),
                        Double.parseDouble(request.getParameter("price")));
                dao.insertGame(game);
            } else if ("update".equals(action)) {
                Videogame game = new Videogame(
                        Integer.parseInt(request.getParameter("id")),
                        request.getParameter("title"),
                        request.getParameter("genre"),
                        request.getParameter("platform"),
                        Double.parseDouble(request.getParameter("price")));
                dao.updateGame(game);
            } else if ("delete".equals(action)) {
                int id = Integer.parseInt(request.getParameter("id"));
                dao.deleteGame(id);
            }
            response.sendRedirect("videogames");
        } catch (SQLException e) {
            throw new ServletException(e);
        }
    }
}


6ï¸âƒ£ Crear las vistas (JSPs)
---------------------------
ğŸ“ webapp/
- videogames.jsp â†’ muestra la lista (READ)
- videogame-form.jsp â†’ formulario de aÃ±adir/editar (CREATE/UPDATE)
- Cada JSP se comunica con el servlet usando parÃ¡metros `action`:
    - videogames.jsp:
        - action=new â†’ abrir formulario vacÃ­o
        - action=edit&id=X â†’ abrir formulario con datos
        - action=delete&id=X â†’ eliminar
    - videogame-form.jsp:
        - action=insert â†’ guardar nuevo
        - action=update â†’ guardar cambios

7ï¸âƒ£ Flujo general del CRUD
--------------------------
| AcciÃ³n del usuario       | PeticiÃ³n                         | Servlet         | MÃ©todo DAO             | JSP usado            |
|--------------------------|---------------------------------|----------------|----------------------|--------------------|
| Ver lista                | GET /videogames                  | doGet()        | listAllGames()        | videogames.jsp      |
| Nuevo videojuego         | GET /videogames?action=new       | doGet()        | â€”                    | videogame-form.jsp  |
| Guardar nuevo            | POST /videogames?action=insert  | doPost()       | insertGame()          | redirige a lista    |
| Editar                   | GET /videogames?action=edit&id=X| doGet()        | getGameById()         | videogame-form.jsp  |
| Guardar ediciÃ³n          | POST /videogames?action=update  | doPost()       | updateGame()          | redirige a lista    |
| Eliminar                 | POST /videogames?action=delete  | doPost()       | deleteGame()          | redirige a lista    |
